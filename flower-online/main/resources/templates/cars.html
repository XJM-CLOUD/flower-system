<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>春之语欢迎你</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" href="../static/css/flower.css" th:href="@{/css/flower.css}">
    <link rel="stylesheet" href="../static/css/bootstrap-treeview.css" th:href="@{/css/bootstrap-treeview.css}">
    <script src="../static/js/jquery.min.js" th:src="@{/js/jquery.min.js}"></script>
    <script src="../static/js/bootstrap.min.js" th:src="@{/js/bootstrap.min.js}"></script>
    <script src="../static/js/bootstrap-treeview.js" th:src="@{/js/bootstrap-treeview.js}"></script>
</head>
<body>
<div th:include="common/header :: header"></div>
<!--banner广告位-->
<div class="container-fluid banner">
    <img src="../static/img/nybanner.jpg" th:src="@{/img/nybanner.jpg}">
</div>
<div class="container-fluid content">
    <div class="row">
        <div class="col-md-3 ">
            <!--左侧导航页面-->
            <div th:include="common/left :: left_menu"></div>
        </div>
        <!--右侧主体-购物车-->
        <div class="col-md-9  panel panel-danger">
            <div class="panel-heading">
                <h3 class="panel-title">
                    我的购物车
                </h3>
            </div>
            <div class="panel-body">
                <div class="page-header text-center">
                    <table class="table" id="cars_tab">
                        <thead>
                        <tr>
                            <th><input type="checkbox" class="checkall"/></th>
                            <th class="text-center">商品图片</th>
                            <th class="text-center">商品名称</th>
                            <th class="text-center">市场价</th>
                            <th class="text-center">订购价</th>
                            <th class="text-center">数量</th>
                            <th class="text-center">小计</th>
                            <th class="text-center">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="car:${session.cars}" id="tab">
                            <td><input type="checkbox" class="checkChild"/></td>
                            <td>
                                <img style="width:100px;height:100px;"
                                     src="../static/product/pro1.jpg"
                                     th:if="${car.value.goods.goodsPic ==null || car.value.goods.goodsPic ==''}"
                                     th:src="@{/product/pro1.jpg}" title="暂无图片"/>
                                <img style="width:100px;height:100px;" src="../static/product/pro1.jpg"
                                     th:if="${car.value.goods.goodsPic !=null and car.value.goods.goodsPic !=''}"
                                     th:src="@{'/'+${car.value.goods.goodsPic}}"/>
                            </td>
                            <td><a href=""
                                   th:text="${car.value.goods.goodsName}">Unicorn-粉色巨型玫瑰园（永生花）</a></td>
                            <td><span th:text="${car.value.goods.goodsShijia}"></span></td>
                            <td><span th:text="${car.value.goods.goodsPrice}" class="price"></span></td>
                            <td>
                                <button class="btn btn-danger btn-sm min"><span
                                        class="glyphicon glyphicon-minus"></span>
                                </button>
                                <input class="text_box" type="text" style="width:50px;"
                                       value="" th:value="${car.value.mount}">
                                <button class="btn btn-danger btn-sm add"><span class="glyphicon glyphicon-plus"></span>
                                </button>
                            </td>
                            <td><span th:text="${car.value.goods.goodsPrice * car.value.mount}"
                                      class="perAllPrice"></span>
                            </td>
                            <td>Bangalore</td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="panel-footer col-md-12">
                        <div class="col-md-offset-6 col-md-6"> <span>总价:<label id="totalPrice"
                                                                               style="color:red;"></label>&nbsp;&nbsp;&nbsp;</span><a
                                class="btn btn-warning" href="">&nbsp;&nbsp;去结算>>>>&nbsp;&nbsp;</a></div>
                    </div>
                </div>
            </div>
        </div>
        <!--右侧结束-->
    </div>
</div>
</div>

<!--footer-->
<div th:include="common/footer :: footer"></div>
</body>
<!--分类结束-->
<script th:inline="javascript">
    /*<![CDATA[*/
    function addCar(id) {
        $.ajax({
            cache: false,
            type: "POST",
            data: {id: id},
            url: /*[[@{/car/addCar}]]*/'#',
            async: false,
            success: function (data) {
                $("#car_number").html([[${session.carNumber}]] + 1);
                alert(data);
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert("操作出现异常");
            }
        });
    };


    //全选框选中时，子复选框都选上
    // $(".checkall").click(function () {
    //     var check = $(this).prop("checked");
    //     $(".checkchild").prop("checked", check);
    // });

    $(".checkal").click(function () {
        if ($(".checkall").checked) {
            var oneCheck = $(".checkchild");
            for (var i = 0; i < oneCheck.length; i++) {
                oneCheck[i].checked = true;
                oneCheck.eq(i).attr("checked", "checked");
            }
            setPrice();
        } else {
            var oneCheck = $(".checkchild");
            for (var i = 0; i < oneCheck.length; i++) {
                oneCheck[i].checked = false;
                oneCheck.eq(i).attr("checked", false);
            }
            // 反选总价清零
            $('#totalPrice').html(0);
        }
    });

    // 计算所有选中产品总价
    function setPrice() {
        var total = 0;
        var checkTrue = $(".checkchild");
        for (var i = 0; i < checkTrue.length; i++) {
            total = parseInt(total) + parseInt(checkTrue.eq(i).parent().parent().find('span[class*=perAllPrice]').text());
        }
        $('#totalPrice').html(total);
    }


    $(function () {
        //购物车添加
        $(".add").click(function () {
            var t = $(this).parent().find('input[class*=text_box]');
            t.val(parseInt(t.val()) + 1);
            var price = $(this).parent().parent().find('span[class*=price]').text();
            var perAllPrice = parseInt(t.val()) * parseFloat(price);
            $(this).parent().parent().find('span[class*=perAllPrice]').html(perAllPrice);
        });
        //购物车减少
        $(".min").click(function () {
            var t = $(this).parent().find('input[class*=text_box]');
            t.val(parseInt(t.val()) - 1);
            var price = $(this).parent().parent().find('span[class*=price]').text();
            var perAllPrice = parseInt(t.val()) * parseFloat(price);

            $(this).parent().parent().find('span[class*=perAllPrice]').html(perAllPrice);
            if (parseInt(t.val()) < 0) {
                t.val(0);
                $(this).parent().parent().find('span[class*=perAllPrice]').html(0);
            }
            setPrice();
        });

        //改变

    });


    /*]]>*/
</script>
</html>
